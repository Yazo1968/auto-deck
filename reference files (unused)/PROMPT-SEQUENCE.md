# Infonugget v3.0 — AI Prompt Sequence

| # | Phase | Prompt | File | Model | Input | Output | Objective | Prompt Logic & Structure |
|---|-------|--------|------|-------|-------|--------|-----------|--------------------------|
| 1a | Document Parse | `DOCX_ANALYSIS_PROMPT` | `documentAnalysis.ts` | Gemini Flash 3 | Word document HTML content (converted from DOCX via mammoth) | Clean Markdown content only (no explanations) | Convert DOCX HTML to structured Markdown | Static prompt with 4 focus areas: (1) identify and hierarchically order all headings H1–H4, (2) preserve all tables, lists, and bold emphasis, (3) clean up conversion artifacts and formatting noise, (4) maintain logical flow of original document. Returns ONLY Markdown, no preamble. |
| 1b | Document Parse | `PDF_ANALYSIS_PROMPT` | `documentAnalysis.ts` | Claude Sonnet 4.5 | PDF as base64 images + text (multimodal) | Well-structured Markdown content only (no explanations) | Convert PDF to structured Markdown with layout-aware handling | Static prompt with 5 PDF-specific challenge sections: (1) **Multi-column layouts** — read columns left-to-right per page, don't mix columns, maintain reading order; (2) **Headers/Footers** — identify repeated elements, exclude from content; (3) **Page breaks** — don't create artificial paragraph breaks, merge continuous text across pages, use `---` only for true section dividers; (4) **Tables spanning pages** — merge into single continuous table; (5) **Footnotes** — place inline as parenthetical text, never collect at end. **Image/Chart handling**: data charts (bar/line/pie/scatter/column/area/radar/heatmap) → extract ALL data points into Markdown table with caption `**Table X: [desc] (Converted from [type])**` including headers, labels, values, units; photos/diagrams → replace with descriptive text block `> **[Figure: desc]** — brief summary`. **Heading hierarchy**: `#` for document title, `##` for main sections, `###` for subsections, reflect actual hierarchy, never skip levels. **Formatting rules**: code blocks with language tag, `-` for unordered lists, `1.` for ordered, proper table alignment, `>` for blockquotes, preserve hyperlinks. **Exclusions**: page numbers, repeating headers/footers, watermarks, irrelevant metadata. |
| 2 | Content Synthesis | `buildSynthesisPrompt()` | `contentGeneration.ts` | Gemini Flash 3 | `headingText` (string), `level` (DetailLevel), `fullDocument` (string — entire document for context), `sectionText` (string — focused section data) | Infographic-ready text at target word count | Extract and restructure a document section into infographic-ready content | Dynamic prompt built from 4 parameters. Word count range set by detail level: Executive → 70–100, Standard → 150–200, Detailed → 300–350. Prompt structure: title line `Content Generation — [headingText]`, instruction to read full document for context then focus on the heading including all sub-sections. **Task**: extract and restructure into infographic-ready text at the word count, preserving all key data/arguments/relationships; output must make hierarchy, logic, and connections clear without referring back to source. **Requirements** (5 rules): (1) reproduce all meaningful content, no omissions, no invented info; (2) make explicit any implied relationships (cause-effect, sequence, hierarchy, comparison, part-to-whole); (3) concise direct phrasing, no filler/repetition; (4) preserve all data points, statistics, specific terms exactly; (5) only number headings for inherent sequential order (steps, phases, stages, ranked), use descriptive headings without numbers for thematic/categorical/parallel content. **Heading hierarchy**: no section title as heading (added separately), `##` for main sections, `###` for subsections, never skip levels, never use `#` (reserved for section title). Appends full document as `FULL DOCUMENT CONTEXT` and section as `FOCUS SECTION DATA`. |
| 3 | Visual Planning | `buildPlannerPrompt()` | `contentGeneration.ts` | Gemini Flash 3 | `headingText` (string), `synthesisContent` (string — output from Phase 2), `style` (string — visual style name), `fonts` (FontPair, optional — primary + secondary font names) | Layout blueprint in 6-section text format | Create a spatial arrangement plan for how the content should be visually arranged — layout, spacing, hierarchy, composition only; NOT what content appears | Dynamic prompt with role: "expert information designer". **Critical rule**: DO NOT rewrite, paraphrase, summarize, abbreviate, or omit any content. Reference items by existing headings/labels/bullet text. All content passes verbatim to renderer. **6-section output format**: (1) **LAYOUT TYPE** — choose from: top-down flowchart (sequential/pipelines/cause-effect), radial/hub-spoke (central concept + satellites), grid/matrix (comparisons/feature tables/multi-dimensional), left-to-right timeline (chronological/phase-based), nested hierarchy (part-to-whole/org charts/taxonomies), split/column layout (before-after/pros-cons/dual perspectives), layered/stacked (architecture diagrams/protocol stacks); (2) **COMPONENT INVENTORY** — boxes/cards with content section mapping, relative size, grouping; connectors/arrows with direction; icons by purpose description (not names); section dividers; callout badges for statistics/key numbers; (3) **SPATIAL ARRANGEMENT** — precise placement (top/center/bottom), grouping vs. separation, flow direction (left→right, top→down), relative sizing (visual dominance); (4) **EMPHASIS & HIERARCHY** — primary focal point (largest/most prominent), secondary elements, supporting details (smaller/peripheral); (5) **STYLE NOTES** — how the `[style]` aesthetic applies: shape style (rounded/sharp/organic/geometric), line weight, connector style, icon treatment (outlined/filled/decorative), background treatment (solid/gradient/textured); (6) **TYPOGRAPHY** (mandatory, three-tier using specified fonts): Title — `fonts.primary` Bold, 36–48pt, prominent top band; Section headers — `fonts.primary` SemiBold, 22–28pt, above content blocks; Body text — `fonts.secondary` Regular, 16–20pt; Callout labels — `fonts.primary` Bold/SemiBold, sized for emphasis; must specify exact font, weight, approximate pt size for every text element. **Rules**: be explicit about spatial positions ("top-left", "center row"), reference ALL content items, no rewriting/paraphrasing, no invented info, no color hex codes (provided separately to renderer), keep descriptions concise but unambiguous. |
| 4 | Card Generation | `buildVisualizerPrompt()` | `imageGeneration.ts` | Gemini Pro Image | `headingText` (string), `contentToMap` (string — synthesized content from Phase 2), `settings` (StylingOptions: palette, style, fonts, aspectRatio, resolution), `visualPlan` (string, optional — layout plan from Phase 3) | Rendered infographic image (base64 PNG) | Translate synthesized content into a polished infographic image | Branches into two modes based on whether `visualPlan` is provided. **Planner-guided mode** (with visualPlan): Role is "Master Visual Renderer". Receives content block and visual layout plan. Rendering protocols: (1) PLAN FIDELITY — follow plan's spatial arrangement, component types, hierarchy, typography specs exactly; (2) LEGIBILITY — all text high-contrast and readable, do not drop any text. Design parameters injected: color palette (background/primary/secondary/accent/text from `settings.palette`), aspect ratio, resolution. **Direct mode** (without visualPlan): Role is "Master Visual Designer". 4 operational protocols: (1) LITERALITY — every node, label, description must be clearly rendered and legible; (2) SPATIAL ARCHITECTURE — use text hierarchy to dictate layout (top-down for processes, radial for clusters); (3) LEGIBILITY ENFORCEMENT — all text ≥24px equivalent at 1080p, high-contrast pairings for all labels; (4) STYLE FIDELITY — strictly follow `[settings.style]` aesthetic, icons must match style. Design instructions include: style name, full 5-color palette (with strict "DO NOT USE ANY OTHER COLORS"), typography (three-tier hierarchy using `settings.fonts`: Title → primary Bold 36–48pt at top, Section headers → primary SemiBold 22–28pt, Body → secondary Regular 16–20pt, Callouts → primary Bold/SemiBold), aspect ratio, resolution. Both modes mark design parameters as "DO NOT INCLUDE IN IMAGE". |
| 5a | Image Modification | `buildModificationPrompt()` | `imageGeneration.ts` | Gemini Pro Image | `instructions` (string — rendered annotation descriptions), `headingText` (string or null); also receives as image context: original infographic + redline overlay on black background | Modified infographic image (base64 PNG) | Apply annotation-based modifications to specific areas of an existing card | Dynamic prompt with role "precise image editor". Receives two images: (1) original infographic, (2) redline overlay map showing annotations on black background. 5 critical rules: (1) **STYLE FIDELITY** — maintain exact same visual style, color palette, typography, design language as original; (2) **MINIMAL DISRUPTION** — only modify specific annotated areas, leave everything else exactly as-is; (3) **LITERAL INTERPRETATION** — execute each instruction precisely as written, no creative interpretations unless specifically asked; (4) **SPATIAL ACCURACY** — use redline map coordinates to locate exactly where changes apply; (5) **QUALITY PRESERVATION** — output must match original image quality and resolution. Modification instructions (from annotations) are injected as-is. **4-step process**: (1) study original image — note style, colors, fonts, layout; (2) cross-reference redline map to locate each annotation spatially; (3) apply each modification in order maintaining consistency; (4) output complete modified image. |
| 5b | Content Update | `buildContentModificationPrompt()` | `imageGeneration.ts` | Gemini Pro Image | `content` (string — updated synthesis), `headingText` (string or null), `style` (string, optional), `palette` (5-color object, optional); also receives as image context: the reference/original card image | Re-rendered infographic image (base64 PNG) | Re-render infographic with updated content while preserving the original card's visual style | Dynamic prompt with role "Master Visual Designer". Receives two things: (1) reference infographic image (to study visual style), (2) updated content to render. 6 critical rules: (1) **STYLE FIDELITY** — new image must look like it belongs to same visual family as reference, same style/palette/typography/design language; (2) **CONTENT LITERALITY** — every node, label, description must be clearly rendered and legible; (3) **SPATIAL ARCHITECTURE** — use text hierarchy to dictate layout; (4) **TYPOGRAPHY HIERARCHY** — three-tier: Title (`#`, largest, top of canvas) > Section headers (`##`, medium, above content groups) > Body text (descriptions/data, readable), heading font for titles and headers, body font from reference; (5) **LEGIBILITY ENFORCEMENT** — all text ≥24px at 1080p, high-contrast pairings; (6) **STYLE** — follow `[style]` aesthetic (only if style param provided). Palette instructions conditionally appended if palette is provided (5 colors, strict "DO NOT USE ANY OTHER COLORS"). **4-step process**: (1) study reference image — note exact visual style, colors, fonts, icon style, layout approach; (2) read updated content carefully; (3) generate new infographic with updated content using reference style as guide; (4) output complete new image. |
